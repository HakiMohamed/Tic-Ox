<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tic.Pem</title>
    <link rel="stylesheet" href="css/style.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      #parent {
        display: flex;
        flex-direction: column;
        gap: 20px;
        align-items: center;
      }

      #TableDesCases {
        display: grid;
        background-color: #f8f4f4;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }

      .caseStyle {
        width: 30px;
        height: 30px;
        background-color: rgb(222, 225, 225);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 1px solid #303030;
        font-size: 20px;
        font-weight: bold;
        transition: background-color 0.3s;
      }

      .caseStyle:hover {
        background-color: #ddd;
      }

      .x {
        color: blue;
      }

      .o {
        color: green;
      }

      #scoreboard {
        background-color: #ffffff;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        width: 100%;
        max-width: 400px;
        text-align: center;
      }

      .score-container {
        display: flex;
        justify-content: space-around;
        align-items: center;
      }

      .player {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .player-label {
        font-size: 14px;
        font-weight: bold;
        color: #555;
      }

      .score-number {
        font-size: 30px;
        font-weight: bold;
        color: #333;
      }

      #scoreX {
        color: #007bff;
      }

      #scoreO {
        color: #28a745;
      }

      #modal {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        transform: translate(-50%, -50%);
        background-color: #00000030;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        z-index: 1000;
      }
      
      #modalContent {
        
        background-color: #fff;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        text-align: center;
        border-radius: 8px;
        width: 300px;   
        max-width: 90%;
      }
      

      #modalContent h2 {
        margin: 0 0 10px;
      }

      #modalContent .button {
        margin: 10px;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
      }

      #modalContent .button:hover {
        background-color: #ddd;
      }

      #continueButton {
        background-color: #007bff;
        color: white;
      }

      #restartButton {
        background-color: #28a745;
        color: white;
      }

      #turnParent {
        position: fixed;
        top: 20px;
        left: 20px;
        background-color: #fff;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s, color 0.3s;
      }

      #turnmessage {
        background-color: #ffffff;
        font-size: 18px;
        font-weight: bold;
        margin: 0;
        transition: color 0.3s;
      }

      .x-turn {
        color: blue;
        background-color: #ffffff;
      }

      .o-turn {
        color: rgb(5, 209, 5);
        border: #303030;
        border-width: 1px;
        background-color: #ffffff;
      }

      .x-hover:hover {
        background-color: blue;
        color: white;
      }

      .o-hover:hover {
        background-color: rgb(41, 214, 6);
        color: white;
      }

      
      .winning-cell {
        transition: background-color 1ms;
        background-color: gold; 
      }

      #scoreDesplayer {
        text-align: center;
      }

      #Dvscore {
        display: flex;
        justify-content: center;
        gap: 40px;
        flex-wrap: wrap;
      }

      .score {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #fff;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        width: 100px;
        max-width: 120px;
      }

      .player-label {
        font-size: 12px;
        font-weight: bold;
        color: #555;
      }

      .score-number {
        font-size: 20px;
        font-weight: bold;
        color: #333;
      }

      #XscoreNumber {
        color: #007bff;
      }

      #OscoreNumber {
        color: #28a745;
      }

      /* Media Queries for responsiveness */
      @media (max-width: 600px) {
        #TableDesCases {
          padding: 5px;
        }

        .caseStyle {
          width: 25px;
          height: 25px;
          font-size: 18px;
        }

        #scoreboard {
          width: 90%;
        }

        .score-number {
          font-size: 18px;
        }
      }

      @media (max-width: 400px) {
        .caseStyle {
          width: 20px;
          height: 20px;
          font-size: 16px;
        }

        #scoreDesplayer {
          font-size: 14px;
        }

        .score-number {
          font-size: 16px;
        }
      }
    </style>
  </head>

  <body>
    <div id="parent">
      <div id="modal">
        <div id="modalContent">

          <h2 id="modalMessage"></h2>
          <button id="continueButton" onclick="continuegame();" class="button">
            Continue
          </button>
          <button id="restartButton" onclick="restartgame();" class="button">
            Restart
          </button>
        </div>
      </div>

      <div id="turnParent">
        <div id="turncontenu">
          <h2 id="turnmessage">Player X Turn</h2>
        </div>
      </div>

      <div id="scoreDesplayer">
        <div id="Dvscore">
          <div id="Xscore" class="score">
            <div class="player-label">Player X</div>
            <div class="score-number" id="XscoreNumber">0</div>
          </div>
          <div id="Oscore" class="score">
            <div class="player-label">Player O</div>
            <div class="score-number" id="OscoreNumber">0</div>
          </div>
        </div>
      </div>

      <div id="TableDesCases"></div>
    </div>

    <script>
      const board = document.getElementById("TableDesCases");
      const moadl = document.getElementById("modal");
      const modalMessage = document.getElementById("modalMessage");

      let currentPlayer = "X";

      const rows = 20;
      const cols = 20;

      let gameBoard = [];

      for (let i = 0; i < rows; i++) {
        let row = [];
        for (let j = 0; j < cols; j++) {
          row.push(null);
        }
        gameBoard.push(row);
      }

      function drawBoard(rows, cols) {
        board.innerHTML = "";

        board.style.gridTemplateColumns = `repeat(${cols}, 30px)`;
        board.style.gridTemplateRows = `repeat(${rows}, 30px)`;

        for (let i = 0; i < rows * cols; i++) {
          const caseDiv = document.createElement("div");
          caseDiv.classList.add("caseStyle");
          caseDiv.dataset.index = i;
          caseDiv.addEventListener("click", clickXO);
          board.appendChild(caseDiv);
        }
        updateHoverClass();
      }

      function clickXO(event) {
        const CasedivClick = event.target;
        const index = CasedivClick.dataset.index;
        console.log(index);
        const row = Math.floor(index / cols);
        const col = index % cols;

        if (gameBoard[row][col] !== null) {
          CasedivClick.style.cursor = "Not-allowed";
          return;
        }

        CasedivClick.textContent = currentPlayer;
        CasedivClick.classList.add(currentPlayer.toLowerCase());

        gameBoard[row][col] = currentPlayer;

        if (checkWinner(row, col, currentPlayer)) {
          moadl.style.display = "block";
          modalMessage.textContent = "Player  " + currentPlayer + " a gagnÃ© !";
          document.getElementById("turnParent").style.display = "none";
          
          return;
        }

        currentPlayer = currentPlayer === "X" ? "O" : "X";
        const turnMessage = document.getElementById("turnmessage");
        turnMessage.textContent = `Player ${currentPlayer} Turn`;
        turnMessage.classList.remove("x-turn", "o-turn");
        turnMessage.classList.add(currentPlayer === "X" ? "x-turn" : "o-turn");
        document.body.style.backgroundColor =
          currentPlayer === "O" ? "#007bff" : "#28a745";
        updateHoverClass();
      }

      function checkWinner(row, col, player) {

        let winningCells = [];

        let horizontalCount =  countInDirection(row, col, player, 1, 0,winningCells) + countInDirection(row, col, player, -1, 0,winningCells);

        let verticalCount = countInDirection(row, col, player, 0, 1,winningCells) + countInDirection(row, col, player, 0, -1,winningCells);

        let diagonalDescCount = countInDirection(row, col, player, 1, 1,winningCells) + countInDirection(row, col, player, -1, -1,winningCells);

       
        let diagonalAscCount = countInDirection(row, col, player, 1, -1,winningCells) + countInDirection(row, col, player, -1, 1,winningCells);

        if (
          horizontalCount >= 4 ||
          verticalCount >= 4 ||
          diagonalDescCount >= 4 ||
          diagonalAscCount >= 4
        ) {

            

            winningCells.push(document.querySelector(`[data-index="${row * cols + col}"]`));

            
            winningCells.forEach((cell, index) => {
                setTimeout(() => {
                    cell.classList.add("winning-cell");
                }, index * 100); 
            });

            

           
        
          updateScore(player);
          return true; 
        }

        return false; 
      }

      function countInDirection(row, col, player, rowDirection, colDirection,winningCells) {

        let currentRow = row + rowDirection; 
        let currentCol = col + colDirection; 
        let count = 0;
        
        
        while (
          currentRow >= 0 &&
          currentRow < rows &&
          currentCol >= 0 &&
          currentCol < cols &&
          gameBoard[currentRow][currentCol] === player
        ) {
          count++; 
          winningCells.push(document.querySelector(`.caseStyle[data-index="${currentRow * cols + currentCol }"]`));
          currentRow = currentRow + rowDirection; 
          currentCol = currentCol+ colDirection; 

        }

        return count; 
        
      }

     
      let scoreX = 0;
      let scoreO = 0;


      function saveScores() {
        localStorage.setItem('scoreX', scoreX);
        localStorage.setItem('scoreO', scoreO);
      }

      function updateScore(winner) {
        if (winner === "X") {
          scoreX++;
          document.getElementById("XscoreNumber").textContent = scoreX;
        } else if (winner === "O") {
          scoreO++;
          document.getElementById("OscoreNumber").textContent = scoreO;
        }
        saveScores();
      }

      function loadScores() {
        const storedScoreX = localStorage.getItem('scoreX');
        const storedScoreO = localStorage.getItem('scoreO');
        
        if (storedScoreX !== null) {
          scoreX = parseInt(storedScoreX, 10);
          document.getElementById("XscoreNumber").textContent = scoreX;
        }
        
        if (storedScoreO !== null) {
          scoreO = parseInt(storedScoreO, 10);
          document.getElementById("OscoreNumber").textContent = scoreO;
        }
      }
        
      
      window.onload = function() {
        loadScores();
        drawBoard(rows, cols);
      };
      

      
      

      




      function updateHoverClass() {
        const allCases = document.querySelectorAll(".caseStyle");
        allCases.forEach((DivCase) => {
          DivCase.classList.remove("x-hover", "o-hover");
          DivCase.classList.add(currentPlayer === "X" ? "x-hover" : "o-hover");
        });
      }

      function resetGame() {
        gameBoard = [];
        for (let i = 0; i < rows; i++) {
          let row = [];
          for (let j = 0; j < cols; j++) {
            row.push(null);
          }
          gameBoard.push(row);
        }

        drawBoard(rows, cols);
        currentPlayer = "X";
        document.body.style.backgroundColor = "#28a745";
      }

      drawBoard(rows, cols);

      function continuegame() {
        document.getElementById("turnParent").style.display = "flex";
        resetGame();
        moadl.style.display = "none";
      }

      function restartgame() {
        document.getElementById("turnParent").style.display = "flex";
        resetGame();
        scoreX = 0; 
        scoreO = 0; 
        saveScores();
        document.getElementById("XscoreNumber").textContent = scoreX;
        document.getElementById("OscoreNumber").textContent = scoreO;
        moadl.style.display = "none";
        document.body.style.backgroundColor = "#28a745";

      }
    </script>
  </body>
</html>
